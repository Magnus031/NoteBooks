# <center>å¹¶å‘ç¼–ç¨‹</center>
> æˆ‘ä»¬ä»¥ `Java` è¯­è¨€ä¸ºä¾‹ï¼Œæ¥è®²è§£ä¸€ä¸‹å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€çŸ¥è¯†ã€‚

JUC ç¼–ç¨‹ `Java.util.concurrent` åŒ…çš„ç¼©å†™

## åŸºç¡€çŸ¥è¯†

### ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹

è¯¦ç»†è§ è¿™ä¸ªé“¾æ¥ğŸ”—

### è¿›ç¨‹ã€çº¿ç¨‹ä¸åç¨‹çš„åŒºåˆ«

- è¿›ç¨‹ ï¼š**æ˜¯æ“ä½œç³»ç»Ÿä¸­è¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½**

    æ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä»–ä»¬éƒ½æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œä¸è¿›è¡Œå…±äº«ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹çš„å †å’Œæ ˆã€‚æ‰€ä»¥è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å°±éœ€è¦æ¶ˆæ¯é˜Ÿåˆ—ã€ç®¡é“ã€å…±äº«å†…å­˜ç­‰æ–¹å¼æ¥è¿›è¡Œé€šä¿¡ã€‚
    
    - ä¼˜ç‚¹ï¼š è¿›ç¨‹ä¹‹é—´ä¸ä¼šäº’ç›¸å¹²æ‰°ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒäº†ï¼Œä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ï¼Œå…·æœ‰æ¯”è¾ƒé«˜çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§
    - ç¼ºç‚¹ï¼š è¿›ç¨‹ä¹‹é—´çš„åˆ‡æ¢å¼€é”€æ¯”è¾ƒå¤§ï¼Œå› ä¸ºè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡éœ€è¦é€šè¿‡å†…æ ¸æ¥è¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥å¼€é”€æ¯”è¾ƒå¤§ã€‚æ¯æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šéœ€è¦æ¯”è¾ƒå¤§çš„å¼€é”€ã€‚

- çº¿ç¨‹ ï¼š **æ˜¯æ“ä½œç³»ç»Ÿä¸­CPUè°ƒåº¦åŸºæœ¬å•ä½**

    åŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹éƒ½æ˜¯å…±äº«å†…å­˜å’Œå…¨å±€å˜é‡çš„ï¼Œæ‰€ä»¥é€šä¿¡çš„æˆæœ¬å¾ˆä½ã€‚ä½†æ˜¯ä¹Ÿè¦æ³¨æ„çº¿ç¨‹å®‰å…¨æ€§ã€‚

    - ä¼˜ç‚¹ï¼š çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢å¼€é”€æ¯”è¾ƒå°ï¼Œå› ä¸ºçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡å…±äº«å†…å­˜æ¥è¿›è¡Œé€šä¿¡çš„ï¼Œæ‰€ä»¥å¼€é”€æ¯”è¾ƒå°ã€‚
    - ç¼ºç‚¹ï¼š çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºçº¿ç¨‹ä¹‹é—´æ˜¯å…±äº«å†…å­˜çš„ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ç”±äºçº¿ç¨‹å…±äº«èµ„æºï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å‡ºç° **æ­»é”** å’Œ **æ•°æ®ç«äº‰** çš„é—®é¢˜ã€‚éœ€è¦ä½¿ç”¨åˆ°é”æ¥è¿›è¡Œä¿æŠ¤ã€‚
    - ã€ä½¿ç”¨åœºæ™¯ã€‘ï¼šé€‚åˆ Web æœåŠ¡å™¨çš„çº¿ç¨‹æ± ï¼Œæ¯ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ª `http` è¯·æ±‚

- åç¨‹ ï¼š **æ˜¯ç”¨æˆ·çº§çš„è½»é‡çº¿ç¨‹ï¼Œç”±ç”¨æˆ·ç¨‹åºè‡ªå·±è°ƒåº¦ï¼Œä¸ä¾èµ–æ“ä½œç³»ç»Ÿ**

    åç¨‹ï¼Œå°±æ˜¯å­—é¢æ„æ€ï¼Œ **ååŠ©**ã€‚è¿™ç§è½»é‡çº¿ç¨‹æ˜¯ç”±ç”¨æˆ·ç¨‹åºè‡ªå·±æ§åˆ¶æš‚åœä¸æ‰§è¡Œï¼Œå±äº **éæŠ¢å å¼è°ƒåº¦**.(ä¸ä¹‹ç›¸å¯¹çš„å°±æ˜¯ **æŠ¢å å¼è°ƒåº¦ï¼Œç”±CPUçš„è°ƒåº¦æ¥å†³å®šçº¿ç¨‹çš„è¿›è¡Œï¼Œè€Œä¸æ˜¯ç”±ç¨‹åºå¯ä»¥è‡ªå‘æ§åˆ¶**)

    **åç¨‹** æ‹¥æœ‰è‡ªå·±çš„æ ˆå’Œå¯„å­˜å™¨ä¸Šä¸‹æ–‡ï¼Œä½†æ˜¯ä¸å…¶ä»–çš„åç¨‹åºå…±äº«å †å†…å­˜ã€‚

    - ä¼˜ç‚¹ï¼šåæˆæ˜¯å±äºæå…¶è½»é‡å¤šçº¿ç¨‹ï¼Œä¸éœ€è¦å†…æ ¸æ€çš„åˆ‡æ¢ã€åˆ›å»ºã€ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬å¾ˆä½ã€‚åç¨‹é€šå¸¸è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œå› æ­¤ä¸ä¼šå­˜åœ¨å¤šçº¿ç¨‹çš„æ•°æ®ç«äº‰é—®é¢˜
    - ç¼ºç‚¹ï¼šä½†æ˜¯ä¹Ÿæ— æ³•åˆ©ç”¨å¤šæ ¸ CPUã€‚
    - ã€ä½¿ç”¨åœºæ™¯ã€‘ï¼šé€‚åˆ IO å¯†é›†å‹çš„åœºæ™¯ï¼Œæ¯”å¦‚çˆ¬è™«ã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚éå¸¸é€‚åˆå¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼Œå¦‚ç½‘ç»œIOã€æ–‡ä»¶IOç­‰ã€‚

## Q1 : å¦‚ä½•æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Ÿ

![P1](./assets/C-p1.jpg)

æˆ‘ä»¬ä¸‹é¢ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹

```java
// thread A 
Thread t1 = new Thread(()->{
    System.out.println("A");
})

// thread B
Thread t2 = new Thread(()->{
    System.out.println("B");
})

// thread C
Thread t3 = new Thread(()->{
    System.out.println("C");
})

```
æ—¶é—´ç‰‡æ˜¯è½®æ¢çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ–¹æ³•æ¥æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚

æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ä¸‰ä¸ªå·¥å…·æ¥è¿›è¡Œçº¿ç¨‹çš„æ§åˆ¶ï¼š

- `Semaphore` : ä¿¡å·é‡ï¼Œç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡
- `CountDownLatch` : é—­é”ï¼Œç”¨æ¥ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆ 3,2,1 è·‘
- `CyclicBarrier` : æ …æ ï¼Œç”¨æ¥ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆï¼Œç„¶åå†ä¸€èµ·æ‰§è¡Œ

#### Semaphore ä¿¡å·é‡
ç”¨äºé™åˆ¶èµ„æºçš„è®¿é—®æ•°é‡ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªèµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œä¾‹å¦‚é™åˆ¶æŸä¸ªæœåŠ¡çš„æœ€å¤§å¹¶å‘è¯·æ±‚æ¬¡æ•°ã€‚

ä¸¤ä¸ªå¸¸ç”¨çš„æ–¹æ³•: 

- `acquire` : è·å–ä¸€ä¸ªè®¸å¯
- `release` : é‡Šæ”¾ä¸€ä¸ªè®¸å¯

å¯¹äº `Semaphore` æ¥è¯´ï¼Œæˆ‘ä»¬å®šä¹‰ä¿¡å·é‡æ•°ç›® `permits` è¡¨ç¤ºçš„æ˜¯å¯ä»¥æœ€å¤§è®¿é—®çš„çº¿ç¨‹æ•°ç›®ã€‚

```java
import java.util.concurrent.Semaphore;

public class SemaphoreExample {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªä¿¡å·é‡ï¼Œæœ€å¤šå…è®¸3ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®
        Semaphore semaphore = new Semaphore(3);

        // æ¨¡æ‹Ÿå¤šä¸ªçº¿ç¨‹
        for (int i = 1; i <= 10; i++) {
            new Thread(() -> {
                try {
                    System.out.println(Thread.currentThread().getName() + " å°è¯•è·å–è®¸å¯...");
                    semaphore.acquire(); // è·å–è®¸å¯
                    System.out.println(Thread.currentThread().getName() + " è·å–è®¸å¯ï¼Œå¼€å§‹æ‰§è¡Œä»»åŠ¡");
                    Thread.sleep(2000); // æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œ
                } catch (InterruptedException e) {
                    e.printStackTrace();
                } finally {
                    System.out.println(Thread.currentThread().getName() + " é‡Šæ”¾è®¸å¯");
                    semaphore.release(); // é‡Šæ”¾è®¸å¯
                }
            }, "çº¿ç¨‹-" + i).start();
        }
    }
}

```


#### CountDownLatch é—­é”
ç”¨äºç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆï¼Œä¾‹å¦‚ä¸»çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆåå†æ‰§è¡Œã€‚
ä¹Ÿå°±æ˜¯è¯´ `CountDownLatch` å…è®¸å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œä¹‹åå†è¿›è¡Œã€‚

ä¸¤ä¸ªå…³é”®çš„æ–¹æ³•:

- `countDown()` : å‡å°‘è®¡æ•°å™¨çš„å€¼
- `await()` : ç­‰å¾…è®¡æ•°å™¨çš„å€¼ä¸º0

åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆè‡ªç„¶çš„çŸ¥é“ï¼Œè¿™ä¸ªé—­é”çš„ä½¿ç”¨æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è®¡æ•°å™¨ä¸º0ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†æ¬¡ä½¿ç”¨äº†ã€‚

```java
import java.util.concurrent.CountDownLatch;

public class CountDownLatchExample {
    public static void main(String[] args) throws InterruptedException {
        // åˆ›å»º CountDownLatchï¼Œè®¡æ•°å™¨åˆå§‹å€¼ä¸º3
        CountDownLatch latch = new CountDownLatch(3);

        // æ¨¡æ‹Ÿä¸‰ä¸ªå­ä»»åŠ¡
        for (int i = 1; i <= 3; i++) {
            new Thread(() -> {
                System.out.println(Thread.currentThread().getName() + " æ­£åœ¨æ‰§è¡Œä»»åŠ¡...");
                try {
                    Thread.sleep(2000); // æ¨¡æ‹Ÿä»»åŠ¡è€—æ—¶
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                System.out.println(Thread.currentThread().getName() + " å®Œæˆä»»åŠ¡");
                latch.countDown(); // ä»»åŠ¡å®Œæˆåè®¡æ•°å™¨å‡ä¸€
            }, "å­ä»»åŠ¡-" + i).start();
        }

        System.out.println("ä¸»çº¿ç¨‹ç­‰å¾…æ‰€æœ‰å­ä»»åŠ¡å®Œæˆ...");
        latch.await(); // ç­‰å¾…è®¡æ•°å™¨å½’é›¶
        System.out.println("æ‰€æœ‰å­ä»»åŠ¡å®Œæˆï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ");
    }
}
```

ä¸Šé¢è¿™ä¸ªä»£ç æ®µçš„é€»è¾‘ä¹Ÿå¾ˆæ¸…æ™°ï¼Œä¹Ÿå°±æ˜¯è¯´è®©ä¸»çº¿ç¨‹ç­‰å¾…å…¶ä»–çš„çº¿ç¨‹è¿è¡Œå®Œæ¯•ä¹‹åå†è¿›è¡Œã€‚


#### CyclicBarrier æ …æ 
å°±åƒæ˜¯å­—é¢æ„æ€ä¸€æ ·ï¼Œå¾ªç¯æ …æ çš„ç›®çš„å°±æ˜¯,å…è®¸ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹éƒ½è¾¾åˆ°æŸä¸ªå…±åŒç‚¹çš„ï¼Œå¯ä»¥é€‰æ‹©æ‰§è¡Œä¸€ä¸ªå¯é€‰çš„å›è°ƒä»»åŠ¡(ç”±`Runnable`å®ç°)ã€‚

ä¸€ä¸ªå…³é”®çš„æ–¹æ³•:

- `await()` è®©çº¿ç¨‹ç­‰å¾…ï¼ŒçŸ¥é“æ‰€æœ‰çš„çº¿ç¨‹éƒ½è°ƒç”¨äº†è¯¥æ–¹æ³•ã€‚
- å¯é€‰çš„å›è°ƒå‡½æ•°

```java
import java.util.concurrent.BrokenBarrierException;
import java.util.concurrent.CyclicBarrier;

public class CyclicBarrierExample {
    public static void main(String[] args) {
        // åˆ›å»º CyclicBarrierï¼Œè®¾ç½®æ …æ ç‚¹ä¸º3ï¼ŒæŒ‡å®šä¸€ä¸ªå›è°ƒä»»åŠ¡
        CyclicBarrier barrier = new CyclicBarrier(3, () -> {
            System.out.println("æ‰€æœ‰çº¿ç¨‹å·²åˆ°è¾¾æ …æ ï¼Œæ‰§è¡Œç»Ÿä¸€ä»»åŠ¡...");
        });

        // æ¨¡æ‹Ÿä¸‰ä¸ªçº¿ç¨‹
        for (int i = 1; i <= 3; i++) {
            new Thread(() -> {
                try {
                    System.out.println(Thread.currentThread().getName() + " æ­£åœ¨æ‰§è¡Œç¬¬ä¸€é˜¶æ®µä»»åŠ¡...");
                    Thread.sleep(2000); // æ¨¡æ‹Ÿç¬¬ä¸€é˜¶æ®µä»»åŠ¡è€—æ—¶
                    System.out.println(Thread.currentThread().getName() + " å®Œæˆç¬¬ä¸€é˜¶æ®µä»»åŠ¡ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹...");
                    barrier.await(); // ç­‰å¾…å…¶ä»–çº¿ç¨‹åˆ°è¾¾æ …æ ç‚¹
                    System.out.println(Thread.currentThread().getName() + " å¼€å§‹æ‰§è¡Œç¬¬äºŒé˜¶æ®µä»»åŠ¡...");
                } catch (InterruptedException | BrokenBarrierException e) {
                    e.printStackTrace();
                }
            }, "çº¿ç¨‹-" + i).start();
        }
    }
}

```




- ä¸‰ä¸ªçº¿ç¨‹äº¤æ›¿è¿›è¡Œ 
 
æˆ‘ä»¬å¾ˆè‡ªç„¶çš„ç¬¬ä¸€ä¸ªæ€è·¯å°±æ˜¯å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œä½†äº‹å®ä¸Šï¼Œè¿™ä¸ªä»£ç æ˜¯æ— æ³•ä¿è¯ä¸‰ä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºçš„ã€‚å› ä¸º æˆ‘ä»¬è¦è€ƒè™‘æ“ä½œç³»ç»Ÿä¸­çš„æ—¶é—´ç‰‡ã€‚

```java
t1.start();
t2.start();
t3.start();
```

å¦‚æœè¿™æ ·ä¸è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è€ƒè™‘ä¿¡å·é‡ `semaphore` ,å¦ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªä¿¡å·é‡ç”±ä¸‰ä¸ªäººä¸€èµ·å…±äº«ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶ä¸‰ä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œä½†æ˜¯æˆ‘ä»¬åˆå¦‚ä½•æ§åˆ¶ä»–ä»¬çš„é¡ºåºå‘¢ï¼Ÿåˆæ€ä¹ˆæ¥ä¿è¯ä»–ä»¬å¯ä»¥äº¤æ›¿çš„è¿›è¡Œå‘¢ï¼Ÿ

æ‰€ä»¥å¦ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸‰ä¸ªä¿¡å·é‡ï¼Œç”±ä¸‰ä¸ªçº¿ç¨‹å…±äº«ï¼Œè¿™æ ·å­å°±å¯ä»¥ä¿è¯ä¸‰ä¸ªçº¿ç¨‹çš„äº¤æ›¿è¿›è¡Œäº†ã€‚

```java
public static void main(){
    int size = 3;
    Semaphore semaphore1 = new Semaphore(1);
    Semaphore semaphore2 = new Semaphore(1);
    Semaphore semaphore3 = new Semaphore(1);

    // The task which we want to implement is that we want to print A,B,C in order

    try{
        // æˆ‘ä»¬å…ˆè®©ä¸‹ä¸€ä¸ªè¦è½®åˆ°çš„çº¿ç¨‹å…ˆå¾—åˆ°äº†ä¸¤æŠŠé”
        semaphore2.acquire();
        semaphore3.acquire();
    }catch(InterruptedException e){
        e.printStackTrace();
    }

    new Thread(()->{
        while(true){
            try{
                semaphore1.acquire();
                // æ­¤æ—¶æˆ‘ä»¬æ‰“å°Açº¿ç¨‹çš„å†…å®¹å·²ç»æ‹¥æœ‰äº†ä¸‰ä¸ªä¿¡å·é‡äº†.
            }catch(InterruptedException e){
                e.printStackTrace();
            }
            try{
                Thread.sleep(100);
            }catch(Exception e){
                e.printStackTrace();
            }
            System.out.println("A");
            // æ”¾å¼€ç¬¬äºŒä¸ªä¿¡å·é‡;
            semaphore2.release();
        }
    }).start();

    // print B ;
    new Thread(()->{
        while(true){
            try{
                // å› ä¸ºæ­¤æ—¶ çº¿ç¨‹A å·²ç»æ”¾å‡ºäº†ä¿¡å·é‡semaphore2çš„ä¿¡å·é‡;
                semaphore2.acquire();
                // æ­¤æ—¶æˆ‘ä»¬æ‰“å°Açº¿ç¨‹çš„å†…å®¹å·²ç»æ‹¥æœ‰äº†ä¸‰ä¸ªä¿¡å·é‡äº†.
            }catch(InterruptedException e){
                e.printStackTrace();
            }
            try{
                Thread.sleep(100);
            }catch(Exception e){
                e.printStackTrace();
            }
            System.out.println("B");
            // æ”¾å¼€ç¬¬äºŒä¸ªä¿¡å·é‡;
            semaphore3.release();
        }
    }).start();

    // print C;
    new Thread(()->{
        while(true){
            try{
                semaphore3.acquire();
                // æ­¤æ—¶æˆ‘ä»¬æ‰“å°Açº¿ç¨‹çš„å†…å®¹å·²ç»æ‹¥æœ‰äº†ä¸‰ä¸ªä¿¡å·é‡äº†.
            }catch(InterruptedException e){
                e.printStackTrace();
            }
            try{
                Thread.sleep(100);
            }catch(Exception e){
                e.printStackTrace();
            }
            System.out.println("C");
            // æ”¾å¼€ç¬¬äºŒä¸ªä¿¡å·é‡;
            semaphore1.release();
        }
    }).start();
}

```

ä»¥ä¸Šçš„ä»£ç å°±å¯ä»¥æ§åˆ¶ä¸‰ä¸ªæ‰“å°äº¤æ›¿è¿›è¡Œï¼›

- ä¸‰ä¸ªçº¿ç¨‹æŒ‰ç…§é¡ºåºè¿›è¡Œ

æˆ‘ä»¬è¿™é‡Œçš„æ€è·¯å°±å¯ä»¥è·Ÿä¸Šé¢ç±»ä¼¼ï¼Œä½†æ˜¯ä¸ä¸€æ ·çš„æ˜¯æˆ‘ä»¬åˆ©ç”¨`volatile`å…³é”®å­—æ¥è¿›è¡Œæ§åˆ¶ã€‚è®©ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶å¯è§

```java
public static void main(){
    int size = 3;
    volatile int flag = 1;

    new Thread(()->{
        while(true){
            if(flag == 1){
                System.out.println("A");
                flag = 2;
            }
        }
    }).start();

    new Thread(()->{
        while(true){
            if(flag == 2){
                System.out.println("B");
                flag = 3;
            }
        }
    }).start();

    new Thread(()->{
        while(true){
            if(flag == 3){
                System.out.println("C");
                flag = 1;
            }
        }
    }).start();
}
```

è¿™æ ·å°±å¯ä»¥ä¿è¯ä¸‰ä¸ªçº¿ç¨‹æŒ‰ç…§é¡ºåºè¿›è¡Œäº†ã€‚åŒæ—¶åªä¼šè¿›è¡Œä¸€æ¬¡ã€‚ä¸ä¼šåƒä¸Šé¢çš„ä»£ç ä¸€æ ·ä¸€ç›´è¿›è¡Œä¸‹å»ã€‚


- å¦‚ä½•è®©ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œ

æˆ‘ä»¬è¿™é‡Œå°±è¦é€‰æ‹© `CountDownLatch` æ¥è¿›è¡Œæ§åˆ¶ä¸‰ä¸ªçº¿ç¨‹ã€‚å› ä¸º`CountDownLatch`çš„ä½œç”¨å°±æ˜¯å€’è®¡æ—¶çº¿ç¨‹ï¼Œä¸€æ—¦å‘ä»¤æªå“äº† `countDown == 0` çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œã€‚

    ```java
    public static void main(){
        int size = 3;
        CountDownLatch latch = new CountDownLatch(1);

        for(int i=0;i<size;i++){
            try{
                // Here we wait for the latch to be 0
                // Once the latch is 0,then we can start the thread
                countDownLatch.await();
                System.out.println("System.currentTimeMillis()");
            }catch(InterruptedException e){ 
                e.printStackTrace();
            }
        }
        // simulate the process 
        Thread.sleep(100);
        countDownLatch.countDown();
    }
    ```

ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“çš„æ˜¯ `CountDownLatch` æ˜¯ä¸èƒ½å¤ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å®ç°å¯ä»¥å¤ç”¨çš„ `CountDownLatch`ã€‚->æºç åœ¨`RocketMQ`ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´æ˜¯æ”¯æŒ `reset`çš„ï¼Œå°±ä¸ç”¨æ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºä¸€ä¸ª`CountDownLatch`äº†ã€‚

<a href = "https://blog.csdn.net/u013490280/article/details/112580150">å…·ä½“çš„ç»†èŠ‚</a>







<style>
    img{
        margin-left : auto;
        margin-right: auto;
        display:block;
        width:80%;
        border-radius:15px;
    }
</style>
