# <center>生产者和消费者模式</center>

> 这里插一句题外话 生产者和消费者模型其实就是属于设计模式中的一种

## Introduce

> 我们在并发编程的时候，其实本质上就是处理好线程之间的通信问题。而生产者和消费者模型就是一个很好的例子。我们通过平衡生产线程和消费线程的工作能力来提高程序整体处理数据的速度。


其实生产者和消费者模式是通过一个容器来解决生产者和消费者强耦合的问题。二者是不直接进行通信的，而是利用阻塞队列来进行通信。所以生产者生产数据之后不用等待消费者进行处理，而是直接交给阻塞队列。消费者也只需要阻塞队列中获取数据即可。这样实现了 **解耦**。


> 这里插一句题外话：我们在了解过生产者和消费者模式，其实就能发现，设计模式的本质就是 **解耦**，也就是说会寻找那个第三者来解决两个对象之间的耦合问题。我们这里的第三者就是阻塞队列。而 比如工厂模式的第三者就是工厂。（代理可以有代理工厂，序列化也可以有序列化器的工厂...）而在学习设计模式的时候，我们要多关注第三者这个角色，会帮助我们更好的理解这个设计模式。


## 生产者和消费者的使用场景

### HTTPS的长链接

> 在HTTPS的长链接中，我们可以通过生产者和消费者模式来实现。生产者负责生产数据，消费者负责消费数据。这样就可以实现一个长链接的功能。

虽然没有直接的体现出来，但是他的工作机制的确可以看作类比使用了生产者和消费者模式。


生产者 : 客户端发送请求，生成任务

消费者 : 服务器接收请求，处理任务

意外消费者响应请求的速度肯定是要慢于生产者的，所以我们可以利用阻塞队列进行缓冲，其实就是可以接受并发的请求，然后服务器慢慢处理。

**HTTP/2 中的多路复用就是允许并发处理多个请求和响应**

### WebSocket和推送信息

> 在WebSocket中，我们可以通过生产者和消费者模式来实现。生产者负责生产数据，消费者负责消费数据。这样就可以实现一个长链接的功能。

WebSocket是建立在HTTPS之上的长连接协议，允许服务器主动的向客户端推送数据，典型的场景就是实时聊天，股票价格推送等。

