
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/Magnus031/NoteBooks/Tutorial/Java/Java12/">
      
      
        <link rel="prev" href="../Java9/">
      
      
        <link rel="next" href="../Feature/SPI/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Concurrency - Magnus的小站</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter12-concurrency" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Magnus的小站" class="md-header__button md-logo" aria-label="Magnus的小站" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Magnus的小站
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Concurrency
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Magnus031/NoteBooks" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Magnus031/NoteBooks
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Magnus的小站" class="md-nav__button md-logo" aria-label="Magnus的小站" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Magnus的小站
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Magnus031/NoteBooks" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Magnus031/NoteBooks
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于我
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    语言
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            语言
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    JS&TS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            JS&TS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../JS%26TS/JS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../JS%26TS/TS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Java
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    易错点总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Objects and classes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inheritance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Excepetion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generic Programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Java9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Collections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Concurrency
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Concurrency
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#121-what-are-threads" class="md-nav__link">
    <span class="md-ellipsis">
      12.1 What are threads?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#122-thread-states" class="md-nav__link">
    <span class="md-ellipsis">
      12.2 Thread States
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.2 Thread States">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#some-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Some methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#123-thread-properties" class="md-nav__link">
    <span class="md-ellipsis">
      12.3 Thread Properties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.3 Thread Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1231-interrupting-threads" class="md-nav__link">
    <span class="md-ellipsis">
      12.3.1 Interrupting threads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1232-daemon-threads" class="md-nav__link">
    <span class="md-ellipsis">
      12.3.2 Daemon Threads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1234-handlers-for-uncaught-exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      12.3.4 Handlers for Uncaught Exceptions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1235-thread-priorities" class="md-nav__link">
    <span class="md-ellipsis">
      12.3.5 Thread Priorities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#124-synchronization" class="md-nav__link">
    <span class="md-ellipsis">
      12.4 Synchronization 同步
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.4 Synchronization 同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-race-condition" class="md-nav__link">
    <span class="md-ellipsis">
      The race condition 竞态冲突
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Lock Objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1244-condition-objects" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.4 Condition Objects
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.4.4 Condition Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synchronized" class="md-nav__link">
    <span class="md-ellipsis">
      synchronized 关键字
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1246-synchronized-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.6 Synchronized Blocks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1247-the-monitor-concept" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.7 The monitor concept
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1248-volatile-modifier" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.8 volatile modifier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1249-final-variables" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.9 Final Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12410-atomics" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.10 Atomics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12411-deadlocks" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.11 Deadlocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#125-thread-safe-collections" class="md-nav__link">
    <span class="md-ellipsis">
      12.5 Thread-safe collections
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.5 Thread-safe collections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1251-blocking-queues" class="md-nav__link">
    <span class="md-ellipsis">
      12.5.1 Blocking Queues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.5.1 Blocking Queues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1252-efficient-maps-sets-and-queues" class="md-nav__link">
    <span class="md-ellipsis">
      12.5.2 Efficient Maps, Sets and Queues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1253-atomic-update-of-map-entries" class="md-nav__link">
    <span class="md-ellipsis">
      12.5.3 Atomic update of map entries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#126-threads-pool" class="md-nav__link">
    <span class="md-ellipsis">
      12.6 Threads Pool
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.6 Threads Pool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduce" class="md-nav__link">
    <span class="md-ellipsis">
      Introduce
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_9" >
        
          
          <label class="md-nav__link" for="__nav_3_2_9" id="__nav_3_2_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    特性
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_9">
            <span class="md-nav__icon md-icon"></span>
            特性
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Feature/SPI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Feature/Proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    代理
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数据结构与算法
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            数据结构与算法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LeetCode/DP/DP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态规划
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LeetCode/Greedy/Greedy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    贪心算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LeetCode/windows/windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    滑动窗口
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LeetCode/Heap/Heap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    堆
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LeetCode/Tree/BinaryTree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LeetCode/Stack/Stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    栈
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LeetCode/%E6%99%BA%E5%8A%9B%E9%A2%98/Smart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    智力题
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            CS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计网
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            计网
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CS-courses/CN/EasytoMistake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    易错点
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CS-courses/CN/TCP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TCP 层
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    设计模式
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            设计模式
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CS-courses/DesignPattern/DesignPattern/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    设计模式概况
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    技术
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            技术
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Web
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tech/Web/Asyn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    异步
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Economic-Courses" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Economic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    讨饭经历
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            讨饭经历
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    面经
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            面经
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Interview/InExperience/mysql/mysql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数据库
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    项目
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            项目
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2_1" >
        
          
          <label class="md-nav__link" for="__nav_8_2_1" id="__nav_8_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    基于RPC项目
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_1">
            <span class="md-nav__icon md-icon"></span>
            基于RPC项目
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Interview/Project/RPCFrameWork/Introduce/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RPC 项目介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Interview/Project/RPCFrameWork/RPC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RPC 场景题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Interview/Project/RPCFrameWork/Summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RPC 项目总结
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Books" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    一些看过的书
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Experiences" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    拙见
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    源码解析
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            源码解析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_1" >
        
          
          <label class="md-nav__link" for="__nav_11_1" id="__nav_11_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Java
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_1">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SourceCode/Java/Timer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Timer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#121-what-are-threads" class="md-nav__link">
    <span class="md-ellipsis">
      12.1 What are threads?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#122-thread-states" class="md-nav__link">
    <span class="md-ellipsis">
      12.2 Thread States
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.2 Thread States">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#some-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Some methods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#123-thread-properties" class="md-nav__link">
    <span class="md-ellipsis">
      12.3 Thread Properties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.3 Thread Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1231-interrupting-threads" class="md-nav__link">
    <span class="md-ellipsis">
      12.3.1 Interrupting threads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1232-daemon-threads" class="md-nav__link">
    <span class="md-ellipsis">
      12.3.2 Daemon Threads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1234-handlers-for-uncaught-exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      12.3.4 Handlers for Uncaught Exceptions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1235-thread-priorities" class="md-nav__link">
    <span class="md-ellipsis">
      12.3.5 Thread Priorities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#124-synchronization" class="md-nav__link">
    <span class="md-ellipsis">
      12.4 Synchronization 同步
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.4 Synchronization 同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-race-condition" class="md-nav__link">
    <span class="md-ellipsis">
      The race condition 竞态冲突
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Lock Objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1244-condition-objects" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.4 Condition Objects
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.4.4 Condition Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synchronized" class="md-nav__link">
    <span class="md-ellipsis">
      synchronized 关键字
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1246-synchronized-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.6 Synchronized Blocks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1247-the-monitor-concept" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.7 The monitor concept
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1248-volatile-modifier" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.8 volatile modifier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1249-final-variables" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.9 Final Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12410-atomics" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.10 Atomics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12411-deadlocks" class="md-nav__link">
    <span class="md-ellipsis">
      12.4.11 Deadlocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#125-thread-safe-collections" class="md-nav__link">
    <span class="md-ellipsis">
      12.5 Thread-safe collections
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.5 Thread-safe collections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1251-blocking-queues" class="md-nav__link">
    <span class="md-ellipsis">
      12.5.1 Blocking Queues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.5.1 Blocking Queues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1252-efficient-maps-sets-and-queues" class="md-nav__link">
    <span class="md-ellipsis">
      12.5.2 Efficient Maps, Sets and Queues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1253-atomic-update-of-map-entries" class="md-nav__link">
    <span class="md-ellipsis">
      12.5.3 Atomic update of map entries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#126-threads-pool" class="md-nav__link">
    <span class="md-ellipsis">
      12.6 Threads Pool
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.6 Threads Pool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduce" class="md-nav__link">
    <span class="md-ellipsis">
      Introduce
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="chapter12-concurrency"><center>Chapter12 Concurrency</center></h1>
<blockquote>
<p>Concurrency 本章主要讲的是线程，高并发的内容比较重要</p>
<p>This Chapters will talk about the topic of <strong>Multitasks</strong>
</p>
</blockquote>
<p>多进程和多线程的区别是什么呢？</p>
<ul>
<li>每个进程具有完整的一套自己的变量集合</li>
<li>每个线程之间是共享数据的，从而方便他们进行有效率并且更容易的进行交互比起多进程之间的交互。</li>
<li>多线程是很常见的，举个例子，当一个浏览器需要具有同步下载多图片的能力，一个网络服务器具有服务并发的需求的能力。</li>
</ul>
<h2 id="121-what-are-threads">12.1 What are threads?</h2>
<p>Here is the following code block to take a short look of <code>thread</code>;</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">Runnable</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="o">=&gt;</span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">STEPS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MAX_AMOUNT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">random</span><span class="p">();</span>
<span class="w">            </span><span class="n">bank</span><span class="p">.</span><span class="na">transfer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">amount</span><span class="p">);</span>
<span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">DELAY</span><span class="o">*</span><span class="n">Math</span><span class="p">.</span><span class="na">random</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">){</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
<span class="n">t</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</code></pre></div></td></tr></table></div>
<p>首先，我们来看 <code>Runnable r = ()=&gt;{// task code}</code> 这个是一个<code>Lambda</code> 函数，其中 <code>Runnable</code> 是一个函数接口，可以用这个来创造一个线程的实例。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// you can also define the thread by its subclass of the thread class.</span>
<span class="kd">class</span> <span class="nc">MyThread</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">(){</span>
<span class="w">        </span><span class="c1">// task code;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="122-thread-states">12.2 Thread States</h2>
<p>Threads can be 6 states:</p>
<ul>
<li>New </li>
<li>Runnable</li>
<li>Blocked </li>
<li>Waiting</li>
<li>Time Waiting</li>
<li>Terminated</li>
</ul>
<p><img alt="P1" src="../assets/J12-P1.jpg" /></p>
<p><code>New Threads</code>:</p>
<p>When You create a thread with <code>new</code> operator before <code>start</code>. It indicates that the thread is not running yet.</p>
<p><code>Runnable Threads</code>:</p>
<p>After I use the <code>start</code> method, the thread is in the <code>runnable</code> state.</p>
<blockquote>
<p>注意，但是处于 <code>runnable</code> 阶段的线程，不一定时刻在<code>running</code>.这取决于操作系统给他分配的资源调度，是否当前是这个线程在跑。也可能处于 <code>waiting</code> 和 <code>blocked</code> 阶段。</p>
<p>The following 2 states are <code>blocked</code> and <code>waiting</code>: They are temporarily inactive. They does not execute any code and consumes minimal resources.
两者有个区别就在于是 <code>被动</code> 还是 <code>主动</code></p>
</blockquote>
<p><code>blocked</code>:
阻塞态，其实就是在该线程想获取锁的时候，但是发现锁被其他线程所占用了，这个时候就应该进入阻塞态了，等其他线程的锁完全释放的时候，才能获取锁，从而离开<code>blocked</code>.</p>
<p><code>waiting</code>:
When the thread waits for another thread to notify the scheduler of a condition.
以一言蔽之，就是说当某个线程在<strong>主动</strong>等待某个条件满足的时候，直到被其他的线程明确的唤醒</p>
<ul>
<li>线程通过 <code>Object.wait()</code> 或者 <code>Thread.join()</code> 进入 <code>waiting</code> 状态</li>
<li>线程必须等待另一个线程通过 <code>notify()</code> 或 <code>notifyAll()</code> 唤醒</li>
<li><code>waiting</code> 状态不会占用CPU时间</li>
</ul>
<p><code>time waiting</code>
There are several methods that have a timeout parameter.Calling them causes the thread to enter the <strong>timed waiting</strong> state.</p>
<p><code>terminated</code></p>
<ul>
<li>It dies a <strong>natural death</strong> because the <code>run</code> method exits normally.</li>
<li>It dies abruptly because an <strong>uncaught exception</strong> terminates the <code>run</code> method.</li>
</ul>
<h3 id="some-methods">Some methods</h3>
<p><img alt="P2" src="../assets/J12-P2.jpg" />
<img alt="P3" src="../assets/J12-P3.jpg" /></p>
<h2 id="123-thread-properties">12.3 Thread Properties</h2>
<h3 id="1231-interrupting-threads">12.3.1 Interrupting threads</h3>
<blockquote>
<p>The following Java release version stops the <code>stop()</code> and <code>suspend()</code> method.</p>
<p>But with the replacement of using <code>interrupt()</code> method. Or the <code>return</code> statements in the <code>run</code> method body.</p>
</blockquote>
<ul>
<li>The <code>blocked</code> status thread can not be checked by <code>Thread().currentThread().isInterrupted()</code> . Take the place of it , we will use <code>InterruptedException()</code> to terminated the <code>blocked</code> thread.</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Here is the example:</span>
<span class="n">Runnable</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">try</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">isInterrupted</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">do</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// do more work</span>
<span class="w">    </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">){</span>
<span class="w"> </span><span class="c1">// thread was interrupted during sleep or wait</span>
<span class="w"> </span><span class="p">}</span><span class="k">finally</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// cleanup, if required</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="c1">// exiting the run method terminates the thread</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>If you call the <code>sleep()</code> method.Do not use the <code>isInterrupted()</code> to check.</p>
<h3 id="1232-daemon-threads">12.3.2 Daemon Threads</h3>
<p>A daemon thread is simply a thread that has no other role in life than to serve others.<code>timer</code> is the thread that sends regular <code>timer ticks</code> to other threads or threads that clean up stale cache entries.</p>
<h3 id="1234-handlers-for-uncaught-exceptions">12.3.4 Handlers for Uncaught Exceptions</h3>
<p>there is no <code>catch</code> clause to which the exception can be propagated.
Instead, just before the thread dies, the exception is passed to a handler for
uncaught exceptions.</p>
<p>You can install a handler into any thread with the <code>setUncaughtExceptionHandler()</code> method.</p>
<h3 id="1235-thread-priorities">12.3.5 Thread Priorities</h3>
<p><code>setPriority()</code>
In the Oracle JVM for Linux, thread priorities are the same!</p>
<h2 id="124-synchronization">12.4 Synchronization 同步</h2>
<h3 id="the-race-condition">The race condition 竞态冲突</h3>
<blockquote>
<p>from the <code>wiki</code> reference:</p>
<p>A race condition can arise in software when a computer program has multiple code paths that are executing at the same time.<strong> If the multiple code paths take a different amount of time than expected, they can finish in a different order than expected, which can cause software bugs due to unanticipated behavior. </strong>A race can also occur between two programs, resulting in security issues.</p>
<p>Critical race conditions cause invalid execution and software bugs. Critical race conditions often happen when the processes or threads depend on some shared state. Operations upon shared states are done in critical sections that must be mutually exclusive. Failure to obey this rule can corrupt the shared state.</p>
</blockquote>
<h3 id="lock-objects">Lock Objects</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">myLock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
<span class="k">try</span><span class="p">{</span>
<span class="w">    </span><span class="c1">// critical section;</span>
<span class="p">}</span><span class="k">finally</span><span class="p">{</span>
<span class="w">    </span><span class="n">myLock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This construct guarantees that there only one thread at a time can enter the critical section. No other thread has the chance to get past the <code>lock</code> statement.</p>
<p><img alt="P4" src="../assets/J12-P4.jpg" /></p>
<h3 id="1244-condition-objects">12.4.4 Condition Objects</h3>
<p>我们经常会发现有些时候，一些线程在进入<code>critical section</code>的时候，当且仅当满足某种条件的时候，因此我们这里引入一个 <code>condition object</code> 来管理那些获得锁，但是不能正确的完成工作的线程。</p>
<p>下面举了一个例子，那就是当银行只有盈利的时候，才能让其他用户取钱。如果不盈利，就一直处于僵持状态，需要等待别的线程来让它增加收入，但别的线程又无法进行，就陷入了僵局。此时就引入了<code>condition objects</code>.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">bankLock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
<span class="w">    </span><span class="k">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">accounts</span><span class="o">[</span><span class="n">from</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// wait</span>
<span class="w">        </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// transfer funds</span>
<span class="w">        </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">finally</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">bankLock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Bank</span>
<span class="p">{</span>
<span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">Condition</span><span class="w"> </span><span class="n">sufficientFunds</span><span class="p">;</span>
<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="nf">Bank</span><span class="p">()</span>
<span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span>
<span class="w"> </span><span class="n">sufficientFunds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bankLock</span><span class="p">.</span><span class="na">newCondition</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
当 <code>transfer</code> 发现<code>sufficient funds</code> 不可得的时候，那么就会 <code>sufficient.await()</code>.当前线程就会被迫放弃这个锁，让其他的线程可以进入<code>critical section</code>.</p>
<blockquote>
<p>There is an essential difference between a thread that is waiting to acquire
a lock and a thread that has called <code>await</code>. Once a thread calls the <code>await</code> method,
it enters a <code>wait set</code> for that condition. The thread is not made <code>runnable</code> when
the lock is available. Instead, it stays deactivated until another thread has
called the <code>signalAll</code> method on the same condition.</p>
</blockquote>
<p><code>sufficientFunds.signAll()</code> 的作用是唤醒所有在<code>waiting list</code> 中的线程</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// One example</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">bankLock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
<span class="w">    </span><span class="k">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">accounts</span><span class="o">[</span><span class="n">from</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">            </span><span class="n">sufficientFunds</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// transfer funds</span>
<span class="w">        </span><span class="c1">// . . .</span>
<span class="w">        </span><span class="n">sufficientFunds</span><span class="p">.</span><span class="na">signalAll</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">finally</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">bankLock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>拱手让出，以免陷入僵持状态。</p>
<h4 id="synchronized"><code>synchronized</code> 关键字</h4>
<p><code>synchronized</code> 关键字的主要作用是<strong>控制线程对共享资源的访问</strong>，确保在同一时刻只有一个线程能够访问被同步的方法或代码块，从而避免线程安全问题</p>
<p>你可以直接使用 <code>synchronized</code> 关键字 
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// code block 1 </span>
<span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">method</span><span class="p">(){</span>
<span class="w">    </span><span class="c1">// method body;</span>
<span class="p">}</span>

<span class="c1">// code block 2</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">method</span><span class="p">(){</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">intrinsicLock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
<span class="w">    </span><span class="k">try</span><span class="p">{</span>
<span class="w">       </span><span class="c1">// method body;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
上面两段 code block 是等价的，我们用 <code>synchronized</code> 关键字来等价的完成这一操作，让只有一个线程可以调用这个方法。</p>
<p>在上面那么多铺垫之后，我们就能很自然的理解下面这段代码了。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">class</span> <span class="nc">Bank</span>
<span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">double</span><span class="o">[]</span><span class="w"> </span><span class="n">accounts</span><span class="p">;</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">accounts</span><span class="o">[</span><span class="n">from</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
<span class="w">            </span><span class="n">wait</span><span class="p">();</span><span class="w"> </span><span class="c1">// wait on intrinsic object lock&#39;s single condition</span>
<span class="w">        </span><span class="n">accounts</span><span class="o">[</span><span class="n">from</span><span class="o">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">        </span><span class="n">accounts</span><span class="o">[</span><span class="n">to</span><span class="o">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">        </span><span class="n">notifyAll</span><span class="p">();</span><span class="w"> </span><span class="c1">// notify all threads waiting on the condition</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">getTotalBalance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p><code>wait()</code> 和 <code>notifyAll()</code> 就分别是将线程加入 <code>waiting list</code> 和 唤醒所有在 <code>waiting on the condition threads</code>.</p>
<p><code>join</code> method in the <code>Thread</code> class is used to pause the execution of the current thread until the specified thread has finished executing. This ensure that one thread must wait for another to complete before continuing.</p>
<h3 id="1246-synchronized-blocks">12.4.6 Synchronized Blocks</h3>
<blockquote>
<p>Another way to enter acquiring the lock;</p>
</blockquote>
<p>锁对象的设置，我们在同步块的时候，定义了锁对象<code>private Lock lock = new Object()</code>,后续我们也利用了<code>synchronized (lock)</code> 进行对锁对象的同步设置。</p>
<p>主要是这样可以更加的灵活进行锁的对象的设置</p>
<ul>
<li><code>this</code></li>
<li><code>class</code></li>
<li><code>lock</code> 自定义的锁对象</li>
</ul>
<h3 id="1247-the-monitor-concept">12.4.7 The monitor concept</h3>
<blockquote>
<p>The powerful tools to make multithreading safe without forcing programmers to think about explicit locks.</p>
</blockquote>
<ul>
<li><code>monitor</code> 是 JVM 内置的锁，每个Java对象都有一个隐式 <code>monitor</code></li>
<li>只有一个线程可以持有对象 <code>monitor</code> 其他线程就会进行 <code>block</code>，自动加入 <code>waiting list</code></li>
<li>线程退出 <code>synchronized</code> 块的时候，释放<code>monitor</code></li>
</ul>
<h3 id="1248-volatile-modifier">12.4.8 volatile modifier</h3>
<ul>
<li>
<p>保证了线程之间的可见性 (Visibility)</p>
<p>当一个线程修改了<code>volatile</code> 变量的值，其他线程能立刻看到这个更新</p>
</li>
<li>
<p>防止指令的重排 (Reordering)</p>
<p>就像在操作系统中线程之间的同步的时候所说，有时候编译器(这里应该是 CPU &amp;&amp; JVM) 会对指令进行重拍，导致会出现一些上锁的错误</p>
</li>
</ul>
<h3 id="1249-final-variables">12.4.9 Final Variables</h3>
<p>There is one situation that we no use <code>lock</code> or the <code>volatile</code> modifier, that it is safe to access a shared field when We use <code>final</code>.</p>
<p><code>final var accounts = new HashMap&lt;String, Double&gt;()</code></p>
<p>如果没有 <code>final</code> 这个量词，我们无法保证多线程可以安全的看见 <code>accounts</code> 的更新。</p>
<h3 id="12410-atomics">12.4.10 Atomics</h3>
<p>操作的原子性 操作系统中有介绍，不做过多赘述</p>
<h3 id="12411-deadlocks">12.4.11 Deadlocks</h3>
<p>死锁 操作系统中有介绍，不做过多的赘述</p>
<h2 id="125-thread-safe-collections">12.5 Thread-safe collections</h2>
<h3 id="1251-blocking-queues">12.5.1 Blocking Queues</h3>
<p><code>blocking queue</code> 阻塞队列是Java提供的一种线程安全的数据结构。主要是用于解决多线程环境下的生产者-消费者问题。</p>
<ul>
<li>
<p><code>Block queue push</code>
    当队列已经满的时候，生产者（试图往队列中添加元素的对象）会进入<code>block</code>状态，等到队列未满的时候再进行填入。</p>
</li>
<li>
<p><code>Block queue pop</code>
    当队列空的时候，消费者（试图往队列中取出元素的对象）会进入<code>block</code>状态，等到队列中有元素的时候才会填入。</p>
</li>
</ul>
<h4 id="advantages">Advantages</h4>
<ul>
<li><code>Producers and Consumers</code><ol>
<li>生产者线程将数据放入队列，消费者线程从队列中取数据</li>
<li><code>blocking queue</code> 可以自动的平衡数据流，在生产者过快，消费者过慢点时候形成一个<code>balance</code>.</li>
</ol>
</li>
</ul>
<p><img alt="P5" src="../assets/J12-P5.jpg" /></p>
<h3 id="1252-efficient-maps-sets-and-queues">12.5.2 Efficient Maps, Sets and Queues</h3>
<p>我们可以使用 <code>java.util.concurrent</code> 包中的一些数据结构 <code>ConcurrentHashMap</code>,<code>ConcurrentSkipListSet</code>,<code>ConcurrentLinkedQueue</code>.</p>
<blockquote>
<p>The concurrent hash map can efficiently support a large number of readers and a bounded number of writers.</p>
</blockquote>
<h3 id="1253-atomic-update-of-map-entries">12.5.3 Atomic update of map entries</h3>
<p>引入了 <code>map.compute(word,(k,v)-&gt;v == null ? 1 : v+1)</code> 的原子操作，避免了旧版本的 <code>replace</code> 的使用.</p>
<h2 id="126-threads-pool">12.6 Threads Pool</h2>
<blockquote>
<p>线程池</p>
<p>我们考虑一个很现实的问题，对于创建一个新的进程是一件很麻烦的时候，因为你需要跟操作系统进行交互。但是我们又会经常的遇到那种具有很大数量的<code>short-lived</code> 线程，这种时候我们就选择了一种叫做<strong>线程池</strong>的方式。</p>
</blockquote>
<h3 id="introduce">Introduce</h3>
<p>线程池中存在很多预留的线程等待调度和运行，并且提供给它一个 <code>Runnable</code> 接口，只要<code>run</code>方法存在，那么这个线程就不会消亡，只是在队列中等待被调度。</p>
<style>
    img{
        margin-left : auto;
        margin-right: auto;
        display:block;
        width:80%;
        border-radius:15px;
    }
</style>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>